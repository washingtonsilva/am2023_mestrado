---
title: "Análise Multivariada"
subtitle: "Análise Fatorial"
author: "Prof. Washington Santos da Silva"
institute: "IFMG - Campus Formiga"
date: today
date-format: long
lang: "pt"
format: 
  revealjs:
    slide-number: true
    progress: true
    incremental: false
    transition: slide
    code-link: true
    self-contained: false
    preview-links: false
    chalkboard: false
    overview: true
    logo: img/logo.jpeg
    css: logo.css
editor: source
crossref:
  fig-title: '**Fig.**'
  fig-labels: arabic
  title-delim: "**.**"
execute: 
  echo: true
bibliography: referencias.bib
csl: associacao-brasileira-de-normas-tecnicas.csl
---


## Visão Geral

Esta apresentação é principalmente uma introdução *conceitual* à análise 
fatorial.

Vamos nos concentrar mais em conceitos e melhores práticas do que em detalhes técnicos:

- Motivação e noções básicas
- Análise Fatorial Exploratória (AFE)
- Análise Fatorial Confirmatória (AFC)


## Motivação

- A Análise Fatorial (FA) é uma família de técnicas para avaliar 
a presença de construtos (conceitos) em pesquisas e avaliações psicológicas.

- **Fatores** são considerados **variáveis latentes**, variáveis que não 
podem ser observadas diretamente, mas que podem ser imperfeitamente medidas através da sua relação com outras variáveis.

- Podemos identificar exemplos canônicos de fatores em testes psicológicos e educacionais.



## Motivação

- Por exemplo, “inteligência” e “ansiedade” são conceitos abstratos 
(construtos) que não são diretamente observáveis.

- No entanto, considera-se que eles podem ser observados empiricamente 
através de múltiplos comportamentos, cada um dos quais é um indicador 
imperfeito da variável latente subjacente.

- Estes valores observados são conhecidos como *variáveis manifestas* e 
incluem indicadores como pontuações de testes, pesquisas
respostas e outros comportamentos empíricos.



## Motivação

- A Análise Fatorial Exploratória (EFA) busca encontrar o grau em que 
fatores latentes, são responsáveis pela variância observada
das variáveis manifestas.

- Em marketing, frequentemente observa-se um grande número de variáveis que, 
acredita-se, poderiam estar relacionadas a um conjunto menor de construtos subjacentes. 



## Motivação

- Por exemplo, não podemos observar diretamente a **satisfação do cliente**, 
mas podemos observar respostas em pesquisas que incluem perguntas sobre
diferentes aspectos da experiência de um cliente, representando conjuntamente diferentes facetas do construto subjacente, satisfação. 

- Da mesma forma, não podemos observar diretamente a intenção de compra, 
sensibilidade ao preço ou engajamento, mas é possível observar vários
comportamentos que estão relacionados a esses construtos.



## O Conceito Geral - Versão 1 {.smaller}

- A partir das variáveis originais, a análise fatorial (FA) busca encontrar
um número menor de variáveis derivadas (*fatores*) que atendem às seguintes
condições:

1. Capturem ao máximo as correlações entre as variáveis originais 
   (após contabilizar o erro).
2. Cada fator está claramente associado a um subconjunto de variáveis.
3. Cada variável está claramente associada (idealmente) a apenas um fator.
4. Os fatores são diferenciados ao máximo uns dos outros.

- Estas condições raramente são verificadas perfeitamente na prática.

- Entretanto, é possível obter soluções aproximadas, que podem fornecer uma 
estrutura de fatores "simples" e interpretável.



## Exemplo da Versão 1 {.smaller}

Considere a análise fatorial (fictícia) de um teste escolar padronizado:

  Variável                  | Fator 1  | Fator 2  | Fator 3  
--------------------------:|:--------:|:--------:|:--------:
Pontuação aritmética        | 0,45     | **0,88** | 0,25
Pontuação álgebra           | 0,51     | **0,82** | 0,03
Pontuação lógica            | 0,41     | 0,50     | 0,11
Pontuação quebra-cabeça     | 0,25     | 0,42     | 0,07
Pontuação vocabulário       | 0,43     | 0,09     | **0,93**
Pontuação leitura           | 0,50     | 0,14     | **0,85**

Podemos interpretar os fatores produzidos como:

- Fator 1: aptidão geral
- Fator 2: habilidades matemáticas
- Fator 3: competências linguísticas



## O Conceito Geral - Versão 2 {.smaller}

- Outra maneira de olhar para a FA é que ela busca estimar 
  *variáveis latentes*. 

- Uma variável latente é um processo de geração de dados não observável --- 
como um estado mental  --- que se manifesta em quantidades mensuráveis, como 
itens de pesquisas.

- Um artigo propos uma escala para avaliar o interesse em um produto, essa 
escalar foi projetada para avaliar três variáveis latentes:

- Interesse geral em uma categoria de produto
- Interesse detalhado em características específicas
- Interesse no produto como um produto de “imagem”

- Busca-se mensurar uma variável latente avaliando vários itens 
relacionados (manifestações), uma vez que qualquer item único, muito 
provavelmente irá capturar a variável latente de forma imperfeita.



## Exemplo da Versão 2

```{r, echo = FALSE, results ="hide", message = FALSE, warning = FALSE }
# specifica o modelo
piesDataModel <- "Geral =~ 0.9*i1 + 0.7*i2 + 0.5*i3
                  Caracteristica =~ 0.3*i3 + 0.7*i4 + 0.9*i5 + 0.5*i6  + 0.9*i7
                  Imagem =~ 0.2*i3 + 0.8*i8 + 0.9*i9 + 0.8*i10 + 0.7*i11 
                  PIES =~ 0.7*General + 0.8*Feature + 0.8*Image"

# dados simulados
library(lavaan)
set.seed(10001)    
piesSimData.norm <- simulateData(piesDataModel, sample.nobs = 3600)
print(head(piesSimData.norm), digits = 2)

# converter os números reais em itens do tipo Likert na escala de 1 a 7
piesSimData <- data.frame(lapply(piesSimData.norm, 
                          function(x) { cut(x, breaks = 7, labels = FALSE) } ))

# ajusta o modelo estrutural aos dados simulados
# definir o modelo estrutural hierárquico 
piesModel0 <- "Geral =~ i1 + i2 + i3
               Caracteristica =~ i4 + i5 + i6  + i7
               Imagem =~ i8 + i9 + i10 + i11"

pies.fit <- cfa(piesModel0, data = piesSimData, warn = FALSE)

# figura do modelo
library(semPlot)
semPaths(pies.fit, what = "path", fade = FALSE, residuals = FALSE,
         edge.label.cex = 0.75, fixedStyle = 1, edge.color = "darkblue")
```



## O Conceito Geral em matemática simplificada

Resumindo: a matriz das cargas fatoriais multiplicada por sua transposta,
recria aproximadamente a matriz de variância-covariância entre 
as variáveis.

$$
LL' (+ E) = Cov
$$


$$
\tiny
\begin{bmatrix} 
F1.v1 & F2.v1 \\
F1.v2 & F2.v2 \\
F1.v3 & F2.v3
\end{bmatrix}
\begin{bmatrix} 
F1.v1 & F1.v2 & F1.v3 \\
F1.v2 & F2.v2 & F2.v3  
\end{bmatrix}
\quad
=
\quad
\begin{bmatrix} 
v1.v1 & v1.v2 & v1.v3 \\
v2.v1 & v2.v2 & v2.v3 \\
v3.v1 & v3.v2 & v3.v3
\end{bmatrix}
$$



## Tipos de Análise Fatorial

#### Análise Fatorial Exploratória (FA)

- Pergunta quais são os fatores nos dados observados
- Requer interpretação
- Antes de assumir que está correto, necessário confirmar com a CFA

#### Análise Fatorial Confirmatória (CFA)

- Pergunta quão bem um modelo proposto *se ajusta* a determinados dados
- É um tipo de modelagem de equações estruturais (SEM)
- Não fornece uma resposta absoluta; é necessário comparar modelos


## Termos e símbolos principais

- **Variável latente**: um suposto processo cognitivo ou de geração de dados que
leva a dados observáveis. Muitas vezes é uma *construção* teórica. Exemplo:
*Interesse no produto*. Símbolo: círculo/oval.

- **Variável manifesta**: variáveis observáveis que expressam variáveis latentes.
Exemplo: "Quão interessado você está neste produto? [1-5]" Símbolo: caixa.
  
- **Fator**: redução dimensional que estima uma variável latente e seu
relacionamento com variáveis manifestas. Exemplo: Interesse geral em uma 
categoria de produto.



## Termos e símbolos principais
  
**Cargas**: a força do relacionamento entre um fator e uma variável.
Exemplo: *F1 $\rightarrow$ v1 = 0,45*. Intervalo [-1,0 ... 1,0], 
iguais ao *r* de Pearson.



## Visualização

```{r, echo=FALSE, results="hide", message=FALSE, warning=FALSE }
library(semPlot)
semPaths(pies.fit, what = "path", fade = FALSE, residuals = FALSE,
         edge.label.cex = 0.75, fixedStyle = 1, edge.color = "darkblue")
```



## Análise Fatoria Exploratória x PCA

A análise fatorial costuma ser vantajosa em relação ao PCA porque:

- É mais interpretável; FA visa relações claras entre fator/variável.

- FA faz isso *girando* matematicamente os componentes para ter cargas 
  mais claras (e omitindo a variação de "erro" não compartilhada).
  
- FA estima variáveis latentes na presença de erro.



## Etadas para EFA

1. Importar e preparar os dados (padronização e lidar com assimetrias).
   
2. Examine a matriz de correlação para ter uma ideia dos possíveis fatores.

3. Determine o número de fatores.

4. Escolha uma *rotação* dos fatores (mais em instantes).

5. Ajuste o modelo e interprete os fatores resultantes.

6. Repita 3-5 se os resultados não forem claros, selecione o mais útil.

7. Use os scores fatoriais como melhor estimativa do construto/variável 
  latente.
  
  

## Agora ... dados!


